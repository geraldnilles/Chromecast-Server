<html>
<head>
        <title>Chromecast Media Player</title>

<style>
body{
        background-color: #ccf;
}

#message {
        margin-top: 4em;
        text-align: center;
}

video{
	width: 100%;
}

</style>

<script>


function ready(){


	var connection = new WebSocket("ws://127.0.0.1:50505",[]);
	connection.onopen = function () {
		// Say hello to the server... dont think this is needed
		//connection.send('READY'); 
	};

	// Log errors
	connection.onerror = function (error) {
  		console.log('WebSocket Error ' + error);
	};

	// Log messages from the server
	connection.onmessage = function (e) {
		var obj = JSON.parse(e.data || "{}");

		console.log('Server: ' + obj["cmd"]);
		
		parse_command(obj);	
	};

	connection.onclose = function (e){
		console.log("Connection Closed");
	};


	function parse_command(obj){
		var video = document.getElementsByTagName("video")[0];
		switch(obj["cmd"]){
			case "PLAYPAUSE":
				play_pause(video);
				break;
			case "SKIP":
				skip(video,obj);
				break;
			default:
				get_status(video);
		}
	}

	function play_pause(video){
		if( video.paused){
			video.play();
		} else {
			video.pause();
		}

		connection.send("OK")
	}

	function skip(video,obj){
		video.currentTime = video.duration*obj["percent"]/100
		connection.send("OK")
	}

	function get_status(video){
		var obj = {};
		obj["percent"] = video.currentTime/video.duration*100;
		obj["paused"] = video.paused;
		obj["src"] = video.currentSrc;
		connection.send(JSON.stringify(obj));
	}

}


window.onload = ready();

</script>	
</head>
<body>
        <div id="message">
                <h2>Hello Chromecast World!!!</h2>
		<video src="http://media.w3.org/2010/05/bunny/movie.mp4"></video>
	</div>


</body>
</html>

