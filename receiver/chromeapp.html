<html>
<head>
        <title>Chromecast Media Player</title>

<style>
/* Make the background color Non-black so see comments */
body{
        background-color: #ccf;
}

/* Hardcoded to my 720p TV */
video{
	width: 1280px;
	height: 720px;
}

</style>

<script>


function ready(){

	// Hard coded to my NAS server
	var connection = new WebSocket("ws://192.168.0.200:50505",[]);
	connection.onopen = function () {
		// Say hello to the server... dont think this is needed
		//connection.send('READY'); 
	};

	// Log errors
	connection.onerror = function (error) {
  		console.log('WebSocket Error ' + error);
	};

	// Log messages from the server
	connection.onmessage = function (e) {
		var obj = JSON.parse(e.data || "{}");

		console.log('Server: ' + obj["cmd"]);
		
		parse_command(obj);	
	};

	connection.onclose = function (e){
		console.log("Connection Closed");
	};


	function parse_command(obj){
		var video = document.getElementsByTagName("video")[0];
		switch(obj["cmd"]){
			case "PLAYPAUSE":
				play_pause(video);
				break;
			case "SKIP":
				skip(video,obj);
				break;
			case "LOAD":
				load(video,obj);
				break;
			default:
				get_status(video);
		}
	}

	function play_pause(video){
		if( video.paused){
			video.play();
		} else {
			video.pause();
		}

		connection.send("OK")
	}

	function skip(video,obj){
		video.currentTime = video.duration*obj["percent"]/100
		connection.send("OK")
	}

	function get_status(video){
		var obj = {};
		obj["percent"] = video.currentTime/video.duration*100;
		obj["paused"] = video.paused;
		obj["src"] = video.currentSrc;
		connection.send(JSON.stringify(obj));
	}

	function load(video,obj){
		video.src = obj["src"];
		connection.send("OK");
	}

	// TODO Add a periodic WS Connection Check to attempt a reconnect

}


window.onload = ready();

</script>	
</head>
<body>
	<!-- Set Big Buck Bunny as default for development -->
	<video src="/media/The Hammer.mp4"></video>


</body>
</html>

